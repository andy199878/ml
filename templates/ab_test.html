<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B 測試</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; background: #f6f8fa; }
        nav { background: #ffffff; border: 1px solid #e5e7eb; padding: 0.5rem 0.75rem; border-radius: 8px; margin-bottom: 1rem; }
        a { margin-right: 1rem; color: #2563eb; text-decoration: none; }
        a:hover { text-decoration: underline; }
        form { background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; }
        textarea { width: 100%; height: 120px; border: 1px solid #d1d5db; border-radius: 6px; padding: 0.5rem; }
        button { padding: 0.5rem 0.9rem; border: 1px solid #2563eb; background: #2563eb; color: #fff; border-radius: 6px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .card { border: 1px solid #e5e7eb; background: #ffffff; padding: 0.75rem; border-radius: 8px; box-shadow: 0 1px 2px rgba(16,24,40,0.04); }
        .muted { color: #555; font-size: 0.9rem; }
        .error { color: #b00020; margin-top: 0.5rem; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <nav>
        <a href="/">首頁</a>
        <a href="/ab_test">A/B測試</a>
        <a href="/dashboard">儀表板</a>
        <a href="/model_comparison">模型比較</a>
    </nav>

    <h1>A/B 測試</h1>

    <form method="post">
        <label for="review">輸入文字：</label>
        <textarea id="review" name="review" placeholder="輸入文字以同時比較兩個模型...">{% if text %}{{ text }}{% endif %}</textarea>
        <div>
            <button type="submit">開始測試</button>
        </div>
    </form>

    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    {% if model_a and model_b and result_a and result_b %}
        <div class="grid" style="margin-top:1rem;">
            <div class="card">
                <h3>模型 A：{{ model_a }}</h3>
                <div>預測：{{ '正面' if result_a.prediction == 1 else '負面' }}</div>
                <div class="muted">信心度：{{ "%.1f%%" | format(result_a.confidence * 100) }}</div>
                <div class="muted">正面機率：{{ "%.1f%%" | format(result_a.positive_prob * 100) }}</div>
                <div class="muted">負面機率：{{ "%.1f%%" | format(result_a.negative_prob * 100) }}</div>
                <div class="muted">延遲：{{ "%.1f ms" | format(result_a.latency * 1000) }}</div>
            </div>
            <div class="card">
                <h3>模型 B：{{ model_b }}</h3>
                <div>預測：{{ '正面' if result_b.prediction == 1 else '負面' }}</div>
                <div class="muted">信心度：{{ "%.1f%%" | format(result_b.confidence * 100) }}</div>
                <div class="muted">正面機率：{{ "%.1f%%" | format(result_b.positive_prob * 100) }}</div>
                <div class="muted">負面機率：{{ "%.1f%%" | format(result_b.negative_prob * 100) }}</div>
                <div class="muted">延遲：{{ "%.1f ms" | format(result_b.latency * 1000) }}</div>
            </div>
        </div>
        <div class="card" style="margin-top:1rem;">
            <h3>比較</h3>
            <div>模型一致性：
                {% if result_a.prediction == result_b.prediction %}一致{% else %}不一致{% endif %}
            </div>
            <div>信心度差異：{{ "%.1f%%" | format(((result_a.confidence - result_b.confidence) | abs) * 100) }}</div>
            <div>較快者：
                {% if result_a.latency < result_b.latency %}模型 A{% elif result_b.latency < result_a.latency %}模型 B{% else %}相同{% endif %}
            </div>
        </div>
    {% endif %}
</body>
</html>