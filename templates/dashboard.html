<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>儀表板</title>
    <style>
        body { font-family: sans-serif; max-width: 1000px; margin: 2rem auto; padding: 0 1rem; background: #f6f8fa; }
        nav { background: #ffffff; border: 1px solid #e5e7eb; padding: 0.5rem 0.75rem; border-radius: 8px; margin-bottom: 1rem; }
        a { margin-right: 1rem; color: #2563eb; text-decoration: none; }
        a:hover { text-decoration: underline; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
        th, td { border-bottom: 1px solid #e5e7eb; padding: 0.5rem 0.75rem; text-align: left; }
        th { background: #f1f5f9; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; margin-top: 1rem; }
        .card { border: 1px solid #e5e7eb; background: #ffffff; padding: 0.75rem; border-radius: 8px; box-shadow: 0 1px 2px rgba(16,24,40,0.04); }
        .muted { color: #555; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr 1fr; } }
    </style>
</head>
<body>
    <nav>
        <a href="/">首頁</a>
        <a href="/ab_test">A/B測試</a>
        <a href="/dashboard">儀表板</a>
        <a href="/model_comparison">模型比較</a>
    </nav>

    <h1>儀表板</h1>

    {% if error %}
        <div class="card">錯誤：{{ error }}</div>
    {% endif %}

    <h3>彙總</h3>
    <div class="grid">
        <div class="card">
            <div>總預測</div>
            <strong>{% if aggregates %}{{ aggregates.total_predictions }}{% else %}0{% endif %}</strong>
        </div>
        <div class="card">
            <div>平均信心度</div>
            <strong>{% if aggregates %}{{ "%.1f%%" | format(aggregates.avg_confidence * 100) }}{% else %}0%{% endif %}</strong>
        </div>
        <div class="card">
            <div>平均延遲</div>
            <strong>{% if aggregates %}{{ "%.1f ms" | format(aggregates.avg_latency_ms) }}{% else %}0 ms{% endif %}</strong>
        </div>
        <div class="card">
            <div>正面比例</div>
            <strong>{% if aggregates %}{{ "%.1f%%" | format(aggregates.positive_rate * 100) }}{% else %}0%{% endif %}</strong>
        </div>
    </div>

    <h3>各模型統計</h3>
    <table>
        <thead>
            <tr>
                <th>模型</th>
                <th>預測次數</th>
                <th>平均信心度</th>
                <th>平均延遲 (ms)</th>
                <th>正面率</th>
                <th>負面率</th>
            </tr>
        </thead>
        <tbody>
            {% if stats %}
                {% for name, s in stats.items() %}
                    <tr>
                        <td>{{ name }}</td>
                        <td>{{ s.total_predictions }}</td>
                        <td>{{ "%.3f" | format(s.avg_confidence) }}</td>
                        <td>{{ "%.1f" | format(s.avg_latency * 1000) }}</td>
                        <td>{{ "%.1f%%" | format(s.positive_rate * 100) }}</td>
                        <td>{{ "%.1f%%" | format(s.negative_rate * 100) }}</td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="6" class="muted">尚無統計數據</td></tr>
            {% endif %}
        </tbody>
    </table>
</body>
</html>